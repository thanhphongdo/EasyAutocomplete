/*
 * easy-autocomplete
 * jQuery plugin for autocompletion
 * 
 * @author Łukasz Pawełczak (http://github.com/pawelczak)
 * @version 1.3.5
 * Copyright  License: 
 */

var EasyAutocomplete=function(t){return t.Configuration=function(t){function e(t){return void 0!==i[t]&&null!==i[t]}function n(t,e){function n(e,i){for(var a in i)void 0===e[a]&&t.log("Property '"+a+"' does not exist in EasyAutocomplete options API."),"object"==typeof e[a]&&-1===$.inArray(a,o)&&n(e[a],i[a])}n(i,e)}var i={data:"list-required",url:"list-required",dataType:"json",listLocation:function(t){return t},xmlElementName:"",getValue:function(t){return t},autocompleteOff:!0,placeholder:!1,ajaxCallback:function(){},matchResponseProperty:!1,list:{sort:{enabled:!1,method:function(t,e){return t=i.getValue(t),e=i.getValue(e),t<e?-1:t>e?1:0}},maxNumberOfElements:6,hideOnEmptyPhrase:!0,match:{enabled:!1,caseSensitive:!1,method:function(t,e){return t.search(e)>-1}},showAnimation:{type:"normal",time:400,callback:function(){}},hideAnimation:{type:"normal",time:400,callback:function(){}},onClickEvent:function(){},onSelectItemEvent:function(){},onLoadEvent:function(){},onChooseEvent:function(){},onKeyEnterEvent:function(){},onMouseOverEvent:function(){},onMouseOutEvent:function(){},onShowListEvent:function(){},onHideListEvent:function(){}},highlightPhrase:!0,theme:"",cssClasses:"",minCharNumber:0,requestDelay:0,adjustWidth:!0,ajaxSettings:{},preparePostData:function(t,e){return t},loggerEnabled:!0,template:"",categoriesAssigned:!1,categories:[{maxNumberOfElements:4}]},o=["ajaxSettings","template"];this.get=function(t){return i[t]},this.equals=function(t,n){return!(!e(t)||i[t]!==n)},this.checkDataUrlProperties=function(){return"list-required"!==i.url||"list-required"!==i.data},this.checkRequiredProperties=function(){for(var t in i)if("required"===i[t])return logger.error("Option "+t+" must be defined"),!1;return!0},this.printPropertiesThatDoesntExist=function(t,e){n(t,e)},function(){if("xml"===t.dataType&&(t.getValue||(t.getValue=function(t){return $(t).text()}),t.list||(t.list={}),t.list.sort||(t.list.sort={}),t.list.sort.method=function(e,n){return e=t.getValue(e),n=t.getValue(n),e<n?-1:e>n?1:0},t.list.match||(t.list.match={}),t.list.match.method=function(t,e){return t.search(e)>-1}),void 0!==t.categories&&t.categories instanceof Array){for(var e=[],n=0,o=t.categories.length;n<o;n+=1){var a=t.categories[n];for(var r in i.categories[0])void 0===a[r]&&(a[r]=i.categories[0][r]);e.push(a)}t.categories=e}}(),function(){function e(t,n){var i=t||{};for(var o in t)void 0!==n[o]&&null!==n[o]&&("object"!=typeof n[o]||n[o]instanceof Array?i[o]=n[o]:e(t[o],n[o]));return void 0!==n.data&&null!==n.data&&"object"==typeof n.data&&(i.data=n.data),i}i=e(i,t)}(),!0===i.loggerEnabled&&n(console,t),void 0!==t.ajaxSettings&&"object"==typeof t.ajaxSettings?i.ajaxSettings=t.ajaxSettings:i.ajaxSettings={},function(){"list-required"!==i.url&&"function"!=typeof i.url&&(e=i.url,i.url=function(){return e});if(void 0!==i.ajaxSettings.url&&"function"!=typeof i.ajaxSettings.url){var e=i.ajaxSettings.url;i.ajaxSettings.url=function(){return e}}if("string"==typeof i.listLocation){var n=i.listLocation;"XML"===i.dataType.toUpperCase()?i.listLocation=function(t){return $(t).find(n)}:i.listLocation=function(t){return t[n]}}if("string"==typeof i.getValue){var o=i.getValue;i.getValue=function(t){return t[o]}}void 0!==t.categories&&(i.categoriesAssigned=!0)}()},t}(EasyAutocomplete||{}),EasyAutocomplete=function(t){return t.Constans=function(){var t={CONTAINER_CLASS:"easy-autocomplete-container",CONTAINER_ID:"eac-container-",WRAPPER_CSS_CLASS:"easy-autocomplete"};this.getValue=function(e){return t[e]}},t}((EasyAutocomplete=function(t){return t.Logger=function(){this.error=function(t){console.log("ERROR: "+t)},this.warning=function(t){console.log("WARNING: "+t)}},t}(EasyAutocomplete||{}))||{}),EasyAutocomplete=function(t){return t.proccess=function(e,n,i){function o(t,n){return e.get("list").match.caseSensitive||("string"==typeof t&&(t=t.toLowerCase()),n=n.toLowerCase()),!!e.get("list").match.method(t,n)}t.proccess.match=o;var a=n.data;return a=function(t,n){var i=[];if(e.get("list").match.enabled)for(var a=0,r=t.length;a<r;a+=1)o(e.get("getValue")(t[a]),n)&&i.push(t[a]);else i=t;return i}(a,i),a=function(t){return void 0!==n.maxNumberOfElements&&t.length>n.maxNumberOfElements&&(t=t.slice(0,n.maxNumberOfElements)),t}(a),a=function(t){return e.get("list").sort.enabled&&t.sort(e.get("list").sort.method),t}(a)},t}((EasyAutocomplete=function(t){return t.ListBuilderService=function(t,e){function n(e,n){var i={};if(i="XML"===t.get("dataType").toUpperCase()?function(){var i,o={};return void 0!==e.xmlElementName&&(o.xmlElementName=e.xmlElementName),void 0!==e.listLocation?i=e.listLocation:void 0!==t.get("listLocation")&&(i=t.get("listLocation")),void 0!==i?"string"==typeof i?o.data=$(n).find(i):"function"==typeof i&&(o.data=i(n)):o.data=n,o}():function(){var t={};return void 0!==e.listLocation?"string"==typeof e.listLocation?t.data=n[e.listLocation]:"function"==typeof e.listLocation&&(t.data=e.listLocation(n)):t.data=n,t}(),void 0!==e.header&&(i.header=e.header),void 0!==e.maxNumberOfElements&&(i.maxNumberOfElements=e.maxNumberOfElements),void 0!==t.get("list").maxNumberOfElements&&(i.maxListSize=t.get("list").maxNumberOfElements),void 0!==e.getValue)if("string"==typeof e.getValue){var o=e.getValue;i.getValue=function(t){return t[o]}}else"function"==typeof e.getValue&&(i.getValue=e.getValue);else i.getValue=t.get("getValue");return i}function i(e){var n=[];return void 0===e.xmlElementName&&(e.xmlElementName=t.get("xmlElementName")),$(e.data).find(e.xmlElementName).each(function(){n.push(this)}),n}this.init=function(e){var n=[],i={};return i.data=t.get("listLocation")(e),i.getValue=t.get("getValue"),i.maxListSize=t.get("list").maxNumberOfElements,n.push(i),n},this.updateCategories=function(e,i){if(t.get("categoriesAssigned")){e=[];for(var o=0;o<t.get("categories").length;o+=1){var a=n(t.get("categories")[o],i);e.push(a)}}return e},this.convertXml=function(e){if("XML"===t.get("dataType").toUpperCase())for(var n=0;n<e.length;n+=1)e[n].data=i(e[n]);return e},this.processData=function(n,i){for(var o=0,a=n.length;o<a;o+=1)n[o].data=e(t,n[o],i);return n},this.checkIfDataExists=function(t){for(var e=0,n=t.length;e<n;e+=1)if(void 0!==t[e].data&&t[e].data instanceof Array&&t[e].data.length>0)return!0;return!1}},t}(EasyAutocomplete||{}))||{}),EasyAutocomplete=function(t){return t.main=function(e,n){function i(){0!==E.length?m.checkDataUrlProperties()?m.checkRequiredProperties()?(o(),r()):p.error("Will not work without mentioned properties."):p.error("One of options variables 'data' or 'url' must be defined."):p.error("Input field doesn't exist.")}function o(){function t(){var t=E.outerWidth();E.parent().css("width",t)}function e(t,e){return m.get("highlightPhrase")&&""!==e?i(t,e):t}function n(t){return t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&").replace(/\s\s+/g," ").trim()}function i(t,e){n(e);e=(e=e.split(" ")).filter(function(t,e,n){return n.indexOf(t)==e}),t+="";for(var i in e)e[i]&&(t=t.replace(new RegExp("("+e[i]+")","gi"),"<b>$1</b>"));return t}E.parent().hasClass(g.getValue("WRAPPER_CSS_CLASS"))&&(E.next("."+g.getValue("CONTAINER_CLASS")).remove(),E.unwrap()),function(){var e=$("<div>"),n=g.getValue("WRAPPER_CSS_CLASS");m.get("theme")&&""!==m.get("theme")&&(n+=" eac-"+m.get("theme")),m.get("cssClasses")&&""!==m.get("cssClasses")&&(n+=" "+m.get("cssClasses")),""!==h.getTemplateClass()&&(n+=" "+h.getTemplateClass()),e.addClass(n),E.wrap(e),!0===m.get("adjustWidth")&&t()}(),function(){var t=$("<div>").addClass(g.getValue("CONTAINER_CLASS"));t.attr("id",a()).prepend($("<ul>")),t.on("show.eac",function(){switch(m.get("list").showAnimation.type){case"slide":var e=m.get("list").showAnimation.time,n=m.get("list").showAnimation.callback;t.find("ul").slideDown(e,n);break;case"fade":var e=m.get("list").showAnimation.time,n=m.get("list").showAnimation.callback;t.find("ul").fadeIn(e);break;default:t.find("ul").show()}m.get("list").onShowListEvent()}).on("hide.eac",function(){switch(m.get("list").hideAnimation.type){case"slide":var e=m.get("list").hideAnimation.time,n=m.get("list").hideAnimation.callback;t.find("ul").slideUp(e,n);break;case"fade":var e=m.get("list").hideAnimation.time,n=m.get("list").hideAnimation.callback;t.find("ul").fadeOut(e,n);break;default:t.find("ul").hide()}m.get("list").onHideListEvent()}).on("selectElement.eac",function(){t.find("ul li").removeClass("selected"),t.find("ul li").eq(A).addClass("selected"),m.get("list").onSelectItemEvent()}).on("loadElements.eac",function(n,i,o){var a="",r=t.find("ul");r.empty().detach(),S=[];for(var s=0,c=0,l=i.length;c<l;c+=1){var f=i[c].data;if(0!==f.length){void 0!==i[c].header&&i[c].header.length>0&&r.append("<div class='eac-category' >"+i[c].header+"</div>");for(var d=0,g=f.length;d<g&&s<i[c].maxListSize;d+=1)a=$("<li><div class='eac-item'></div></li>"),function(){var t=d,n=s,r=i[c].getValue(f[t]);a.find(" > div").on("click",function(){E.val(r).trigger("change"),A=n,u(n),m.get("list").onClickEvent(),m.get("list").onChooseEvent()}).mouseover(function(){A=n,u(n),m.get("list").onMouseOverEvent()}).mouseout(function(){m.get("list").onMouseOutEvent()}).html(h.build(e(r,o),f[t]))}(),r.append(a),S.push(f[d]),s+=1}}t.append(r),m.get("list").onLoadEvent()}),E.after(t)}(),C=$("#"+a()),m.get("placeholder")&&E.attr("placeholder",m.get("placeholder"))}function a(){var t=E.attr("id");return t=g.getValue("CONTAINER_ID")+t}function r(){function t(){E.focusout(function(){var t,e=E.val();m.get("list").match.caseSensitive||(e=e.toLowerCase());for(var n=0,i=S.length;n<i;n+=1)if(t=m.get("getValue")(S[n]),m.get("list").match.caseSensitive||(t=t.toLowerCase()),t===e)return A=n,void u(A)})}function e(){E.off("keyup").keyup(function(t){function e(t){function e(t,e){return!1===m.get("matchResponseProperty")||("string"==typeof m.get("matchResponseProperty")?e[m.get("matchResponseProperty")]===t:"function"!=typeof m.get("matchResponseProperty")||m.get("matchResponseProperty")(e)===t)}if(!(t.length<m.get("minCharNumber"))){if("list-required"!==m.get("data")){var n=m.get("data"),i=v.init(n);i=v.updateCategories(i,n),l(i=v.processData(i,t),t),E.parent().find("li").length>0?s():c()}var o=function(){var t={},e=m.get("ajaxSettings")||{};for(var n in e)t[n]=e[n];return t}();void 0!==o.url&&""!==o.url||(o.url=m.get("url")),void 0!==o.dataType&&""!==o.dataType||(o.dataType=m.get("dataType")),void 0!==o.url&&"list-required"!==o.url&&(o.url=o.url(t),o.data=m.get("preparePostData")(o.data,t),$.ajax(o).done(function(n){var i=v.init(n);i=v.updateCategories(i,n),i=v.convertXml(i),e(t,n)&&l(i=v.processData(i,t),t),v.checkIfDataExists(i)&&E.parent().find("li").length>0?s():c(),m.get("ajaxCallback")()}).fail(function(){p.warning("Fail to load response data")}).always(function(){}))}}switch(t.keyCode){case 27:c(),f();break;case 38:t.preventDefault(),S.length>0&&A>0&&(A-=1,E.val(m.get("getValue")(S[A])),u(A));break;case 40:t.preventDefault(),S.length>0&&A<S.length-1&&(A+=1,E.val(m.get("getValue")(S[A])),u(A));break;default:if(t.keyCode>40||8===t.keyCode){var n=E.val();!0!==m.get("list").hideOnEmptyPhrase||8!==t.keyCode||""!==n?m.get("requestDelay")>0?(void 0!==d&&clearTimeout(d),d=setTimeout(function(){e(n)},m.get("requestDelay"))):e(n):c()}}})}function n(){E.on("keydown",function(t){if(38===(t=t||window.event).keyCode)return suppressKeypress=!0,!1}).keydown(function(t){13===t.keyCode&&A>-1&&(E.val(m.get("getValue")(S[A])),m.get("list").onKeyEnterEvent(),m.get("list").onChooseEvent(),A=-1,c(),t.preventDefault())})}function i(){E.off("keypress")}function o(){E.focus(function(){""!==E.val()&&S.length>0&&(A=-1,s())})}function a(){E.blur(function(){setTimeout(function(){A=-1,c()},250)})}function r(){E.attr("autocomplete","off")}y("autocompleteOff",!0)&&r(),t(),e(),n(),i(),o(),a()}function s(){C.trigger("show.eac")}function c(){C.trigger("hide.eac")}function u(t){C.trigger("selectElement.eac",t)}function l(t,e){C.trigger("loadElements.eac",[t,e])}function f(){E.trigger("blur")}var d,g=new t.Constans,m=new t.Configuration(n),p=new t.Logger,h=new t.Template(n.template),v=new t.ListBuilderService(m,t.proccess),y=m.equals,E=e,C="",S=[],A=-1;t.consts=g,this.getConstants=function(){return g},this.getConfiguration=function(){return m},this.getContainer=function(){return C},this.getSelectedItemIndex=function(){return A},this.getItems=function(){return S},this.getItemData=function(t){return S.length<t||void 0===S[t]?-1:S[t]},this.getSelectedItemData=function(){return this.getItemData(A)},this.build=function(){o()},this.init=function(){i()}},t.eacHandles=[],t.getHandle=function(e){return t.eacHandles[e]},t.inputHasId=function(t){return void 0!==$(t).attr("id")&&$(t).attr("id").length>0},t.assignRandomId=function(e){var n="";do{n="eac-"+Math.floor(1e4*Math.random())}while(0!==$("#"+n).length);elementId=t.consts.getValue("CONTAINER_ID")+n,$(e).attr("id",n)},t.setHandle=function(e,n){t.eacHandles[n]=e},t}((EasyAutocomplete=function(t){return t.Template=function(t){var e={basic:{type:"basic",method:function(t){return t},cssClass:""},description:{type:"description",fields:{description:"description"},method:function(t){return t+" - description"},cssClass:"eac-description"},iconLeft:{type:"iconLeft",fields:{icon:""},method:function(t){return t},cssClass:"eac-icon-left"},iconRight:{type:"iconRight",fields:{iconSrc:""},method:function(t){return t},cssClass:"eac-icon-right"},links:{type:"links",fields:{link:""},method:function(t){return t},cssClass:""},custom:{type:"custom",method:function(){},cssClass:""}},n=function(t){var n,i=t.fields;return"description"===t.type?(n=e.description.method,"string"==typeof i.description?n=function(t,e){return t+" - <span>"+e[i.description]+"</span>"}:"function"==typeof i.description&&(n=function(t,e){return t+" - <span>"+i.description(e)+"</span>"}),n):"iconRight"===t.type?("string"==typeof i.iconSrc?n=function(t,e){return t+"<img class='eac-icon' src='"+e[i.iconSrc]+"' />"}:"function"==typeof i.iconSrc&&(n=function(t,e){return t+"<img class='eac-icon' src='"+i.iconSrc(e)+"' />"}),n):"iconLeft"===t.type?("string"==typeof i.iconSrc?n=function(t,e){return"<img class='eac-icon' src='"+e[i.iconSrc]+"' />"+t}:"function"==typeof i.iconSrc&&(n=function(t,e){return"<img class='eac-icon' src='"+i.iconSrc(e)+"' />"+t}),n):"links"===t.type?("string"==typeof i.link?n=function(t,e){return"<a href='"+e[i.link]+"' >"+t+"</a>"}:"function"==typeof i.link&&(n=function(t,e){return"<a href='"+i.link(e)+"' >"+t+"</a>"}),n):"custom"===t.type?t.method:e.basic.method};this.getTemplateClass=function(t){var n=function(){return""};return t&&t.type&&t.type&&e[t.type]?function(){var n=e[t.type].cssClass;return function(){return n}}():n}(t),this.build=function(t){return t&&t.type&&t.type&&e[t.type]?n(t):e.basic.method}(t)},t}(EasyAutocomplete||{}))||{});!function(t){t.fn.easyAutocomplete=function(e){return this.each(function(){var n=t(this),i=new EasyAutocomplete.main(n,e);EasyAutocomplete.inputHasId(n)||EasyAutocomplete.assignRandomId(n),i.init(),EasyAutocomplete.setHandle(i,n.attr("id"))})},t.fn.getSelectedItemIndex=function(){var e=t(this).attr("id");return void 0!==e?EasyAutocomplete.getHandle(e).getSelectedItemIndex():-1},t.fn.getItems=function(){var e=t(this).attr("id");return void 0!==e?EasyAutocomplete.getHandle(e).getItems():-1},t.fn.getItemData=function(e){var n=t(this).attr("id");return void 0!==n&&e>-1?EasyAutocomplete.getHandle(n).getItemData(e):-1},t.fn.getSelectedItemData=function(){var e=t(this).attr("id");return void 0!==e?EasyAutocomplete.getHandle(e).getSelectedItemData():-1}}(jQuery);
